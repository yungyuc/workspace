#!/bin/bash

instname=$1
if [ -z $instname ]; then
  echo "Usage: `basename $0` <instance_name> [machine_type]"
  exit
fi
machtype=${2:-n1-standard-1}
startup=$(mktemp -t gcp.startup.XXXXXXXXXX.sh) || exit
cat << EOF >> $startup
timedatectl set-timezone Asia/Taipei
apt-get install -y git build-essential liblapack-pic liblapack-dev
rm -f clone_and_go
wget -q https://raw.githubusercontent.com/yungyuc/workspace/master/bin/admin/bootstrap-workspace.sh
chmod a+rx bootstrap-workspace.sh
mv bootstrap-workspace.sh /var/lib
EOF
echo "Startup file:"
cat $startup | sed -e "s/^/  /"
cmd="gcloud compute instances create $instname --machine-type $machtype \
  --zone asia-east1-c --image-family ubuntu-1404-lts \
  --image-project ubuntu-os-cloud --boot-disk-size 10GB \
  --metadata-from-file startup-script=$startup"
echo $cmd
$cmd
rm -f $startup

# vim: set et nobomb fenc=utf8 ft=sh ff=unix sw=2 ts=2:
